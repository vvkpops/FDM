<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FlyHigh™ Dispatch</title>
  <script src="https://cdn.tailwindcss.com">

// === Flight Filters ===
let flightFilters = [];

function addFlightFilter() {
  const input = document.getElementById("flightFilterInput");
  const value = input.value.trim().toUpperCase();
  if (value && !flightFilters.includes(value)) {
    flightFilters.push(value);
    renderFlightFilters();
    filterFlights();
  }
  input.value = "";
}

function removeFlightFilter(flt) {
  flightFilters = flightFilters.filter(f => f !== flt);
  renderFlightFilters();
  filterFlights();
}

function renderFlightFilters() {
  const container = document.getElementById("activeFlightFilters");
  container.innerHTML = "";
  flightFilters.forEach(flt => {
    const tag = document.createElement("div");
    tag.className = "bg-gray-700 px-2 py-1 rounded flex items-center gap-1 text-xs";
    tag.innerHTML = `${flt} <span class="cursor-pointer text-red-400" onclick="removeFlightFilter('${flt}')">✕</span>`;
    container.appendChild(tag);
  });
}

function filterFlights() {
  const tiles = document.querySelectorAll("#activeFlights .flight-tile");
  tiles.forEach(tile => {
    const callsign = tile.querySelector(".flight-title")?.innerText.trim();
    if (!flightFilters.length || flightFilters.includes(callsign)) {
      tile.style.display = "";
    } else {
      tile.style.display = "none";
    }
  });
}

document.getElementById("flightFilterInput").addEventListener("keypress", e => {
  if (e.key === "Enter") addFlightFilter();
});

// === Wrap updateTile for ETA highlight ===
const _original_updateTile = updateTile;
updateTile = async function(flight, container) {
  await _original_updateTile(flight, container);

  const useAlt = toggleAlt[flight.callsign];
  const icao = useAlt ? flight.alticao : flight.arricao;
  const tafRaw = await fetchTAF(icao);
  const min = minima[flight.callsign] || { ceiling: 500, vis: 1 };

  const tafLines = tafRaw.split("\n");
  let etaLineIndex = -1;
  for (let i = 0; i < tafLines.length; i++) {
    const parsed = parseLine(tafLines[i]);
    const visOk = parsed.isGreater || parsed.visMiles >= min.vis;
    const ceilOk = parsed.ceiling >= min.ceiling;
    if (!(visOk && ceilOk)) { etaLineIndex = i; break; }
  }

  const tafContainer = container.querySelector(".mt-2.text-xs");
  if (tafContainer) {
    const tafDivs = tafContainer.querySelectorAll("div");
    tafDivs.forEach(div => {
      if (div.innerText.startsWith("TAF:")) {
        const lines = tafLines.map((l, i) =>
          `<div class="${i === etaLineIndex ? 'text-red-400 font-bold' : ''}">${l}</div>`
        ).join("");
        div.innerHTML = `<strong>TAF:</strong><br>${lines}`;
      }
    });
  }

  filterFlights();

// Update border based on new CARS-compliant processTAF
const tafCheck = processTAF(tafRaw, min.ceiling, min.vis, flight.eta);
container.classList.remove("border-red-600", "border-green-600");
container.classList.add(tafCheck.below ? "border-red-600" : "border-green-600");

// Add subtle background shading
if (tafCheck.below) {
  container.style.backgroundColor = "rgba(255, 0, 0, 0.05)"; // very light red
} else {
  container.style.backgroundColor = "rgba(0, 255, 0, 0.05)"; // very light green
}

};


// === ETA-based TAF Highlight Patch (Direct Rewrite) ===
const _patched_updateTile = updateTile;
updateTile = async function(flight, container) {
  await _patched_updateTile(flight, container);

  const useAlt = toggleAlt[flight.callsign];
  const icao = useAlt ? flight.alticao : flight.arricao;
  const tafRaw = await fetchTAF(icao);
  const min = minima[flight.callsign] || { ceiling: 500, vis: 1 };

  const tafLines = tafRaw.split("\n");
  let etaLineIndex = -1;

  for (let i = 0; i < tafLines.length; i++) {
    const partialTAF = tafLines.slice(0, i + 1).join("\n");
    const result = processTAF(partialTAF, min.ceiling, min.vis, flight.eta);
    if (result.below) {
      etaLineIndex = i;
      break;
    }
  }

  const tafBlock = container.querySelector(".taf-block");
  if (tafBlock) {
    tafBlock.innerHTML = `<strong>TAF:</strong><br>` + tafLines.map((line, index) =>
      `<div class="${index === etaLineIndex ? 'text-red-400 font-bold' : ''}">${line}</div>`
    ).join("");
  }

  filterFlights();

// Update border based on new CARS-compliant processTAF
const tafCheck = processTAF(tafRaw, min.ceiling, min.vis, flight.eta);
container.classList.remove("border-red-600", "border-green-600");
container.classList.add(tafCheck.below ? "border-red-600" : "border-green-600");

// Add subtle background shading
if (tafCheck.below) {
  container.style.backgroundColor = "rgba(255, 0, 0, 0.05)"; // very light red
} else {
  container.style.backgroundColor = "rgba(0, 255, 0, 0.05)"; // very light green
}

};


// === CARS-Compliant processTAF (Revised) ===
const _original_processTAF = processTAF;
processTAF = function(raw, minC, minV, eta) {
  let below = false;
  if (!raw) return { below };

  const etaDate = new Date(eta);
  const lines = raw.split("\n");
  const segments = [];

  // Extract segments (FM, BECMG, TEMPO, PROB)
  lines.forEach(line => {
    line = line.trim();
    if (!line) return;

    if (line.startsWith("TEMPO") || line.startsWith("PROB")) {
      const probMatch = line.match(/PROB(\d{2})/);
      const probValue = probMatch ? parseInt(probMatch[1]) : null;

      const m = line.match(/(\d{2})(\d{2})\/(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]);
      const eDay = parseInt(m[3]), eHour = parseInt(m[4]);
      const segStart = getDate(sDay, sHour, etaDate);
      const segEnd = getDate(eDay, eHour, etaDate);
      const cond = line.substring(m[0].length).trim();

      // Skip PROB < 30 as per CARS
      if (line.startsWith("PROB") && probValue < 30) return;

      segments.push({ type: line.startsWith("TEMPO") ? "TEMPO" : "PROB", start: segStart, end: segEnd, cond });
    } 
    else if (line.startsWith("BECMG")) {
      const m = line.match(/(\d{2})(\d{2})\/(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]);
      const eDay = parseInt(m[3]), eHour = parseInt(m[4]);
      const segStart = getDate(sDay, sHour, etaDate);
      const segEnd = getDate(eDay, eHour, etaDate);
      const cond = line.substring(m[0].length).trim();
      segments.push({ type: "BECMG", start: segStart, end: segEnd, cond });
    } 
    else if (line.startsWith("FM")) {
      const m = line.match(/FM(\d{2})(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]), sMin = parseInt(m[3]);
      const segStart = getDate(sDay, sHour, etaDate, sMin);
      const cond = line.substring(m[0].length).trim();
      segments.push({ type: "FM", start: segStart, cond });
    }
  });

  // Evaluate TEMPO/PROB first (controlling for alternate minima)
  for (let seg of segments.filter(s => s.type === "TEMPO" || s.type === "PROB")) {
    if (etaDate >= seg.start && etaDate <= seg.end) {
      const p = parseLine(seg.cond);
      if (!(p.isGreater || p.visMiles >= minV) || p.ceiling < minC) below = true;
    }
  }

  // Evaluate BECMG and FM (prevailing conditions)
  if (!below) {
    const fmOrBecmg = segments.filter(s => s.type === "FM" || s.type === "BECMG")
      .sort((a, b) => a.start - b.start);
    for (let seg of fmOrBecmg) {
      if (etaDate >= seg.start && (!seg.end || etaDate <= seg.end)) {
        const p = parseLine(seg.cond);
        if (!(p.isGreater || p.visMiles >= minV) || p.ceiling < minC) below = true;
      }
    }
  }

  return { below };
};

// Helper to construct date
function getDate(day, hour, etaDate, minute = 0) {
  const d = new Date(Date.UTC(etaDate.getUTCFullYear(), etaDate.getUTCMonth(), day, hour, minute));
  return d;
}


function addWeatherICAOFromTile(icao) {
  icao = icao.trim().toUpperCase();
  if (icao && !weatherICAOs.includes(icao)) {
    weatherICAOs.push(icao);
    localStorage.setItem("weatherICAOs", JSON.stringify(weatherICAOs));
    buildWeatherTiles();
  }
}

</script>
  <style>
    @media (min-width: 1536px) {
      .flight-tile {
        font-size: 0.9rem;
        padding: 0.75rem;
      }
      .flight-title {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">

<header class="relative p-4 bg-gray-800 shadow-md text-center text-xl font-bold mb-6 max-w-screen-2xl mx-auto">
  <div id="clock-local" class="absolute left-4 top-1/2 -translate-y-1/2 text-lg font-mono text-gray-300"></div>
  FlyHigh™ Dispatch
  <div id="clock-utc" class="absolute right-4 top-1/2 -translate-y-1/2 text-lg font-mono text-gray-300"></div>

</header>

<!-- Flight Filter Panel -->
<div id="flightFilterPanel" class="fixed top-24 right-4 bg-gray-800 p-4 rounded-lg shadow-lg w-64 border border-gray-700 z-50">
  <h3 class="text-sm font-bold mb-2">Filter Flights</h3>
  <div class="flex gap-2 mb-2">
    <input id="flightFilterInput" type="text" placeholder="Enter flight #"
      class="flex-1 bg-gray-700 p-1 rounded text-xs text-center" />
    <button onclick="addFlightFilter()" class="bg-blue-600 px-2 py-1 rounded text-white text-xs">Add</button>
  </div>
  <div id="activeFlightFilters" class="flex flex-wrap gap-1"></div>
</div>


<!-- NAVIGATION -->
<div class="flex justify-center gap-4 mb-4">
  <button onclick="showPage('flights')" class="bg-blue-600 px-4 py-2 rounded text-white hover:bg-blue-700">Flights Dashboard</button>
  <button onclick="showPage('weather')" class="bg-teal-600 px-4 py-2 rounded text-white hover:bg-teal-700">Weather Monitor</button>
</div>

<!-- GLOBAL FILTERS -->
<div class="max-w-screen-2xl mx-auto px-6 mb-4">
  <div class="flex flex-wrap justify-center items-center gap-4 mb-4">
    <label>Ceiling (ft):
      <input id="globalCeiling" type="number" class="bg-gray-700 p-1 rounded w-24 text-center" />
    </label>
    <label>Visibility (SM):
      <input id="globalVis" type="number" step="0.1" class="bg-gray-700 p-1 rounded w-24 text-center" />
    </label>
    <button onclick="applyGlobalMinima()" class="bg-green-600 px-3 py-1 rounded text-white hover:bg-green-700 text-sm">Apply to All</button>
    <div class="inline-flex bg-gray-700 rounded-full p-1">
      <span id="globalDestSpan" onclick="setGlobal(false)" class="cursor-pointer px-2 py-1 rounded-full font-medium bg-purple-600 text-white">Destination</span>
      <span id="globalAltSpan" onclick="setGlobal(true)" class="cursor-pointer px-2 py-1 rounded-full font-medium text-gray-300">Alternate</span>
    </div>
    <button id="toggleWeatherBtn"
      onclick="toggleWeatherView()"
      class="bg-yellow-600 px-3 py-1 rounded text-white hover:bg-yellow-700 text-sm">
      Minimize Weather
    </button>
  </div>
</div>

<!-- FLIGHTS PAGE -->
<div id="flightsPage" class="w-full px-6">
  <details open>
    <summary class="text-lg font-bold cursor-pointer mb-2">✅ Completed Flights (last 10)</summary>
    <div id="completedFlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 mt-2"></div>
  </details>

  <details open>
    <summary class="text-lg font-bold cursor-pointer mb-2 mt-6">✈️ Enroute & Scheduled Flights (12hr window)</summary>
    <div id="activeFlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6"></div>
  </details>
</div>

<!-- WEATHER PAGE -->
<div id="weatherPage" class="w-full px-6 hidden">
  <div class="flex justify-center gap-2 mb-4">
    <input id="icaoInput" placeholder="Enter ICAO (e.g. CYYT)" class="bg-gray-700 p-2 rounded text-center w-40" />
    <button onclick="addWeatherICAO()" class="bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700">Add ICAO</button>
  </div>
  <div id="weatherTiles" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6"></div>
</div>

<footer class="text-sm text-center text-gray-500 py-4 max-w-screen-2xl mx-auto">
  Live from Google Sheets | Updated <span id="lastUpdated">—</span>
</footer>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FlyHigh™ Dispatch</title>
  <script src="https://cdn.tailwindcss.com">

// === Flight Filters ===
let flightFilters = [];

function addFlightFilter() {
  const input = document.getElementById("flightFilterInput");
  const value = input.value.trim().toUpperCase();
  if (value && !flightFilters.includes(value)) {
    flightFilters.push(value);
    renderFlightFilters();
    filterFlights();
  }
  input.value = "";
}

function removeFlightFilter(flt) {
  flightFilters = flightFilters.filter(f => f !== flt);
  renderFlightFilters();
  filterFlights();
}

function renderFlightFilters() {
  const container = document.getElementById("activeFlightFilters");
  container.innerHTML = "";
  flightFilters.forEach(flt => {
    const tag = document.createElement("div");
    tag.className = "bg-gray-700 px-2 py-1 rounded flex items-center gap-1 text-xs";
    tag.innerHTML = `${flt} <span class="cursor-pointer text-red-400" onclick="removeFlightFilter('${flt}')">✕</span>`;
    container.appendChild(tag);
  });
}

function filterFlights() {
  const tiles = document.querySelectorAll("#activeFlights .flight-tile");
  tiles.forEach(tile => {
    const callsign = tile.querySelector(".flight-title")?.innerText.trim();
    if (!flightFilters.length || flightFilters.includes(callsign)) {
      tile.style.display = "";
    } else {
      tile.style.display = "none";
    }
  });
}

document.getElementById("flightFilterInput").addEventListener("keypress", e => {
  if (e.key === "Enter") addFlightFilter();
});

// === Wrap updateTile for ETA highlight ===
const _original_updateTile = updateTile;
updateTile = async function(flight, container) {
  await _original_updateTile(flight, container);

  const useAlt = toggleAlt[flight.callsign];
  const icao = useAlt ? flight.alticao : flight.arricao;
  const tafRaw = await fetchTAF(icao);
  const min = minima[flight.callsign] || { ceiling: 500, vis: 1 };

  const tafLines = tafRaw.split("\n");
  let etaLineIndex = -1;
  for (let i = 0; i < tafLines.length; i++) {
    const parsed = parseLine(tafLines[i]);
    const visOk = parsed.isGreater || parsed.visMiles >= min.vis;
    const ceilOk = parsed.ceiling >= min.ceiling;
    if (!(visOk && ceilOk)) { etaLineIndex = i; break; }
  }

  const tafContainer = container.querySelector(".mt-2.text-xs");
  if (tafContainer) {
    const tafDivs = tafContainer.querySelectorAll("div");
    tafDivs.forEach(div => {
      if (div.innerText.startsWith("TAF:")) {
        const lines = tafLines.map((l, i) =>
          `<div class="${i === etaLineIndex ? 'text-red-400 font-bold' : ''}">${l}</div>`
        ).join("");
        div.innerHTML = `<strong>TAF:</strong><br>${lines}`;
      }
    });
  }

  filterFlights();

// Update border based on new CARS-compliant processTAF
const tafCheck = processTAF(tafRaw, min.ceiling, min.vis, flight.eta);
container.classList.remove("border-red-600", "border-green-600");
container.classList.add(tafCheck.below ? "border-red-600" : "border-green-600");

// Add subtle background shading
if (tafCheck.below) {
  container.style.backgroundColor = "rgba(255, 0, 0, 0.05)"; // very light red
} else {
  container.style.backgroundColor = "rgba(0, 255, 0, 0.05)"; // very light green
}

};


// === ETA-based TAF Highlight Patch (Direct Rewrite) ===
const _patched_updateTile = updateTile;
updateTile = async function(flight, container) {
  await _patched_updateTile(flight, container);

  const useAlt = toggleAlt[flight.callsign];
  const icao = useAlt ? flight.alticao : flight.arricao;
  const tafRaw = await fetchTAF(icao);
  const min = minima[flight.callsign] || { ceiling: 500, vis: 1 };

  const tafLines = tafRaw.split("\n");
  let etaLineIndex = -1;

  for (let i = 0; i < tafLines.length; i++) {
    const partialTAF = tafLines.slice(0, i + 1).join("\n");
    const result = processTAF(partialTAF, min.ceiling, min.vis, flight.eta);
    if (result.below) {
      etaLineIndex = i;
      break;
    }
  }

  const tafBlock = container.querySelector(".taf-block");
  if (tafBlock) {
    tafBlock.innerHTML = `<strong>TAF:</strong><br>` + tafLines.map((line, index) =>
      `<div class="${index === etaLineIndex ? 'text-red-400 font-bold' : ''}">${line}</div>`
    ).join("");
  }

  filterFlights();

// Update border based on new CARS-compliant processTAF
const tafCheck = processTAF(tafRaw, min.ceiling, min.vis, flight.eta);
container.classList.remove("border-red-600", "border-green-600");
container.classList.add(tafCheck.below ? "border-red-600" : "border-green-600");

// Add subtle background shading
if (tafCheck.below) {
  container.style.backgroundColor = "rgba(255, 0, 0, 0.05)"; // very light red
} else {
  container.style.backgroundColor = "rgba(0, 255, 0, 0.05)"; // very light green
}

};


// === CARS-Compliant processTAF (Revised) ===
const _original_processTAF = processTAF;
processTAF = function(raw, minC, minV, eta) {
  let below = false;
  if (!raw) return { below };

  const etaDate = new Date(eta);
  const lines = raw.split("\n");
  const segments = [];

  // Extract segments (FM, BECMG, TEMPO, PROB)
  lines.forEach(line => {
    line = line.trim();
    if (!line) return;

    if (line.startsWith("TEMPO") || line.startsWith("PROB")) {
      const probMatch = line.match(/PROB(\d{2})/);
      const probValue = probMatch ? parseInt(probMatch[1]) : null;

      const m = line.match(/(\d{2})(\d{2})\/(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]);
      const eDay = parseInt(m[3]), eHour = parseInt(m[4]);
      const segStart = getDate(sDay, sHour, etaDate);
      const segEnd = getDate(eDay, eHour, etaDate);
      const cond = line.substring(m[0].length).trim();

      // Skip PROB < 30 as per CARS
      if (line.startsWith("PROB") && probValue < 30) return;

      segments.push({ type: line.startsWith("TEMPO") ? "TEMPO" : "PROB", start: segStart, end: segEnd, cond });
    } 
    else if (line.startsWith("BECMG")) {
      const m = line.match(/(\d{2})(\d{2})\/(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]);
      const eDay = parseInt(m[3]), eHour = parseInt(m[4]);
      const segStart = getDate(sDay, sHour, etaDate);
      const segEnd = getDate(eDay, eHour, etaDate);
      const cond = line.substring(m[0].length).trim();
      segments.push({ type: "BECMG", start: segStart, end: segEnd, cond });
    } 
    else if (line.startsWith("FM")) {
      const m = line.match(/FM(\d{2})(\d{2})(\d{2})/);
      if (!m) return;
      const sDay = parseInt(m[1]), sHour = parseInt(m[2]), sMin = parseInt(m[3]);
      const segStart = getDate(sDay, sHour, etaDate, sMin);
      const cond = line.substring(m[0].length).trim();
      segments.push({ type: "FM", start: segStart, cond });
    }
  });

  // Evaluate TEMPO/PROB first (controlling for alternate minima)
  for (let seg of segments.filter(s => s.type === "TEMPO" || s.type === "PROB")) {
    if (etaDate >= seg.start && etaDate <= seg.end) {
      const p = parseLine(seg.cond);
      if (!(p.isGreater || p.visMiles >= minV) || p.ceiling < minC) below = true;
    }
  }

  // Evaluate BECMG and FM (prevailing conditions)
  if (!below) {
    const fmOrBecmg = segments.filter(s => s.type === "FM" || s.type === "BECMG")
      .sort((a, b) => a.start - b.start);
    for (let seg of fmOrBecmg) {
      if (etaDate >= seg.start && (!seg.end || etaDate <= seg.end)) {
        const p = parseLine(seg.cond);
        if (!(p.isGreater || p.visMiles >= minV) || p.ceiling < minC) below = true;
      }
    }
  }

  return { below };
};

// Helper to construct date
function getDate(day, hour, etaDate, minute = 0) {
  const d = new Date(Date.UTC(etaDate.getUTCFullYear(), etaDate.getUTCMonth(), day, hour, minute));
  return d;
}


function addWeatherICAOFromTile(icao) {
  icao = icao.trim().toUpperCase();
  if (icao && !weatherICAOs.includes(icao)) {
    weatherICAOs.push(icao);
    localStorage.setItem("weatherICAOs", JSON.stringify(weatherICAOs));
    buildWeatherTiles();
  }
}

</script>
  <style>
    @media (min-width: 1536px) {
      .flight-tile {
        font-size: 0.9rem;
        padding: 0.75rem;
      }
      .flight-title {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">

<header class="relative p-4 bg-gray-800 shadow-md text-center text-xl font-bold mb-6 max-w-screen-2xl mx-auto">
  <div id="clock-local" class="absolute left-4 top-1/2 -translate-y-1/2 text-lg font-mono text-gray-300"></div>
  FlyHigh™ Dispatch
  <div id="clock-utc" class="absolute right-4 top-1/2 -translate-y-1/2 text-lg font-mono text-gray-300"></div>

</header>

<!-- Flight Filter Panel -->
<div id="flightFilterPanel" class="fixed top-24 right-4 bg-gray-800 p-4 rounded-lg shadow-lg w-64 border border-gray-700 z-50">
  <h3 class="text-sm font-bold mb-2">Filter Flights</h3>
  <div class="flex gap-2 mb-2">
    <input id="flightFilterInput" type="text" placeholder="Enter flight #"
      class="flex-1 bg-gray-700 p-1 rounded text-xs text-center" />
    <button onclick="addFlightFilter()" class="bg-blue-600 px-2 py-1 rounded text-white text-xs">Add</button>
  </div>
  <div id="activeFlightFilters" class="flex flex-wrap gap-1"></div>
</div>


<!-- NAVIGATION -->
<div class="flex justify-center gap-4 mb-4">
  <button onclick="showPage('flights')" class="bg-blue-600 px-4 py-2 rounded text-white hover:bg-blue-700">Flights Dashboard</button>
  <button onclick="showPage('weather')" class="bg-teal-600 px-4 py-2 rounded text-white hover:bg-teal-700">Weather Monitor</button>
</div>

<!-- GLOBAL FILTERS -->
<div class="max-w-screen-2xl mx-auto px-6 mb-4">
  <div class="flex flex-wrap justify-center items-center gap-4 mb-4">
    <label>Ceiling (ft):
      <input id="globalCeiling" type="number" class="bg-gray-700 p-1 rounded w-24 text-center" />
    </label>
    <label>Visibility (SM):
      <input id="globalVis" type="number" step="0.1" class="bg-gray-700 p-1 rounded w-24 text-center" />
    </label>
    <button onclick="applyGlobalMinima()" class="bg-green-600 px-3 py-1 rounded text-white hover:bg-green-700 text-sm">Apply to All</button>
    <div class="inline-flex bg-gray-700 rounded-full p-1">
      <span id="globalDestSpan" onclick="setGlobal(false)" class="cursor-pointer px-2 py-1 rounded-full font-medium bg-purple-600 text-white">Destination</span>
      <span id="globalAltSpan" onclick="setGlobal(true)" class="cursor-pointer px-2 py-1 rounded-full font-medium text-gray-300">Alternate</span>
    </div>
    <button id="toggleWeatherBtn"
      onclick="toggleWeatherView()"
      class="bg-yellow-600 px-3 py-1 rounded text-white hover:bg-yellow-700 text-sm">
      Minimize Weather
    </button>
  </div>
</div>

<!-- FLIGHTS PAGE -->
<div id="flightsPage" class="w-full px-6">
  <details open>
    <summary class="text-lg font-bold cursor-pointer mb-2">✅ Completed Flights (last 10)</summary>
    <div id="completedFlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 mt-2"></div>
  </details>

  <details open>
    <summary class="text-lg font-bold cursor-pointer mb-2 mt-6">✈️ Enroute & Scheduled Flights (12hr window)</summary>
    <div id="activeFlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6"></div>
  </details>
</div>

<!-- WEATHER PAGE -->
<div id="weatherPage" class="w-full px-6 hidden">
  <div class="flex justify-center gap-2 mb-4">
    <input id="icaoInput" placeholder="Enter ICAO (e.g. CYYT)" class="bg-gray-700 p-2 rounded text-center w-40" />
    <button onclick="addWeatherICAO()" class="bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700">Add ICAO</button>
  </div>
  <div id="weatherTiles" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6"></div>
</div>

<footer class="text-sm text-center text-gray-500 py-4 max-w-screen-2xl mx-auto">
  Live from Google Sheets | Updated <span id="lastUpdated">—</span>
</footer>
</body>
</html>
